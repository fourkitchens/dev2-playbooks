---
##
# Add a new user.
#
# user_name: The name of the new user, will also be used for group name.
# user_mail: The user's email address as set on fourkitchens.com. Used for authorized_keys.
#
- hosts: all
  sudo: yes 
 
  tasks:

    - name: Create user group.
      action: group name={{user_name}}

    - name: Create the user account.
      action: user name={{user_name}} group={{user_name}} shell=/bin/bash state=present

    - name: SSH Folder.
      action: file path=/home/{{user_name}}/.ssh state=directory owner={{user_name}} group={{user_name}} mode=755

    - name: WWW Folder.
      action: file path=/home/{{user_name}}/www state=directory owner={{user_name}} group={{user_name}} mode=755

    - name: Authorized keys from 4K.com
      action: get_url thirsty=yes url=http://fourkitchens.com/authorized_keys?mail={{user_mail}} dest=/home/{{user_name}}/.ssh/authorized_keys owner={{user_name}} group={{user_name}} mode=644
